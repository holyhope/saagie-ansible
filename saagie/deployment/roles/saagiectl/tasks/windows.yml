---
- name: Download saagiectl
  ansible.windows.win_get_url:
    url: https://storage.googleapis.com/install-archives/saagiectl/{{ saagie_version }}/saagiectl-{{ saagie_version }}-windows-x64.zip
    dest: '{{ cachedir.path }}/saagiectl-{{ saagie_version }}.zip'
  register: download

- name: Setting saagiectl path
  ansible.builtin.set_fact:
    saagiectl: 'saagiectl-windows-x64/bin/saagiectl'

- name: Unzip saagiectl
  community.windows.win_unzip:
    src: '{{ download.dest }}'
    dest: '{{ (working_directory, saagie_install_directory) | join("/") }}'
    remote_src: yes
    list_files: yes
  register: unzip
  failed_when: 'saagiectl not in unzip.files'

- name: Setting saagiectl path
  ansible.builtin.set_fact:
    saagiectl: '{{ saagie_install_directory }}/saagiectl-windows-x64/bin/saagiectl'
